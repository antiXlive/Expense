<!doctype html>
<html lang="en" class="dark">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Expense Manager PWA</title>

  <!-- Tailwind CDN (dark mode only) -->
  <script>
    tailwind = { config: { darkMode: 'class' } }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="manifest" href="./pwa/manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="stylesheet" href="./css/theme-variables.css">
  <style>
    /* Global background to prevent white edges on over-scroll */
    html {
      background: linear-gradient(135deg, #0a0e27 0%, #0f1425 50%, #0a0e27 100%);
      background-attachment: fixed;
      margin: 0;
      padding: 0;
    }

    /* Default safe-area and full app sizing */
    :root {
      --accent: #3b82f6;
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --anim-ease: cubic-bezier(.2, .9, .2, 1);
    }

    body,
    #app {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>

  <!-- Custom global CSS tokens + animations -->
  <link rel="stylesheet" href="./css/app.css">
</head>

<body class="dark text-slate-200 antialiased" style="background: linear-gradient(135deg, #0a0e27 0%, #0f1425 50%, #0a0e27 100%); background-attachment: fixed; margin: 0; padding: 0;">
  <div id="app" class="min-h-screen flex flex-col" style="background: transparent;">
    <app-header></app-header>
    <main id="screens" class="flex-1 relative overflow-y-auto" style="margin-top: 70px;">
      <!-- Screens: hidden/shown by app.js -->
      <lock-screen class="screen hidden"></lock-screen>
      <pin-screen class="screen hidden"></pin-screen>

      <section id="home-screen" class="screen">
        <home-screen></home-screen>
      </section>
      <ai-screen id="ai-screen" class="screen hidden"></ai-screen>
      <stats-screen id="stats-screen" class="screen hidden"></stats-screen>

      <section id="settings-screen-wrap" class="screen hidden">
        <settings-screen></settings-screen>
      </section>

      <!-- modals / overlays -->
      <entry-sheet></entry-sheet>
      <category-picker></category-picker>

    </main>

    <tab-bar></tab-bar>
  </div>

  <!-- Libraries -->
  <script type="module" src="https://unpkg.com/dexie@3/dist/dexie.mjs"></script>

  <!-- App modules -->
  <script type="module" src="./js/utils.js"></script>
  <script type="module" src="./js/event-bus.js"></script>
  <script type="module" src="./js/db.js"></script>
  <script type="module" src="./js/state.js"></script>
  <script type="module" src="./js/worker-stats.js"></script>
  <script type="module" src="./js/app.js"></script>

  <!-- Components -->
  <script type="module" src="./components/entry-sheet.js"></script>
  <script type="module" src="./components/category-picker.js"></script>
  <script type="module" src="./components/ai-screen.js"></script>
  <script type="module" src="./components/stats-screen.js"></script>
  <script type="module" src="./components/settings-screen.js"></script>
  <script type="module" src="./components/lock-screen.js"></script>
  <script type="module" src="./components/pin-screen.js"></script>
  <script type="module" src="./components/tab-bar.js"></script>
  <script type="module" src="./components/home-screen.js"></script>
  <script type="module" src="./components/app-header.js"></script>


  <!-- Register service worker -->
  <script>
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      console.log('Install prompt available');
      // Show install button/notification here if you have one
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          await navigator.serviceWorker.register('./pwa/service-worker.js');
          console.log('Service Worker registered');
        } catch (e) {
          console.warn('SW register failed', e);
        }
      });
    }
  </script>
</body>

</html>